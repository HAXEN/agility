var pages=pages||{};pages.timer=pages.timer||function(){function t(){$.get("./javascripts/templates/mobster.mustache").success(function(t){L=t}).then(n)}function n(){S=$(".counter"),D=S.find(".counter-text"),I=$("input.period"),O=$(".nav-timer"),C=$(".nav-timer-stop"),T=$(".nav-timer-play"),y=$(".nav-timer-pause"),w=$(".nav-timer-settings"),G=$(".add-mobster"),Y=$(".mobster-container"),x=$(".turn-text"),U=[],R=0,S.bind("click",function(){q===M.STOPPED?c():q===M.PAUSED?l():q===M.PLAYING&&s()}),C.bind("click",m),T.bind("click",function(){q===M.STOPPED?c():l()}),y.bind("click",s),w.bind("click",s),G.bind("click",e),window.Notification&&Notification.requestPermission(),m()}function e(){var t=U.length,n=$(Mustache.render(L,{id:t})),e={root:n,name:n.find(".mobster-control-name")[0],disabled:!1};n.find(".mobster-control-turn").bind("click",function(){if(!e.disabled){var t=e.root.index();R=t,f()}}),n.find(".mobster-control-up").bind("click",function(){var t=e.root.index();if(0!==t){var n=U[t-1];e.root.after(n.root),U[t]=U[t-1],U[t-1]=e}}),n.find(".mobster-control-down").bind("click",function(){var t=e.root.index();if(t!==U.length){var n=U[t+1];e.root.before(n.root),U[t]=U[t+1],U[t+1]=e}}),n.find(".mobster-control-disable").bind("click",function(){e.disabled||e===U[R]?(e.disabled=!1,e.root.removeClass("disabled")):(e.disabled=!0,e.root.addClass("disabled"))}),U.push(e),Y.append(e.root)}function o(){var t=I[0].value.split(":");return 60*parseInt(t[0],10)+parseInt(t[1],10)}function i(){B=o()}function r(){return getComputedStyle(S[0])["background-color"]}function a(){if("granted"===Notification.permission){var t="Click here and step away from the keyboard.";u()&&(t+="\n"+U[R].name.value+" is next"),N=new Notification("It's time to rotate!",{body:t,icon:"./images/rotate.png",vibrate:[200,100,200]}),N.onclick=function(){window.focus(),N.close()}}$("audio.alert")[0].play()}function c(){v(M.PLAYING),i(),D.text(h(B)),S.css({"background-color":j.START,transition:"none"}),f(),g()}function s(){q===M.PLAYING&&(v(M.PAUSED),S.css({"background-color":r()}),k())}function l(){v(M.PLAYING),S.css({"background-color":j.END,transition:"background-color "+B+"s"}),g()}function d(){v(M.STOPPED),k(),D.text("Rotate"),a(),b()}function u(){return U.filter(function(t){return!t.disabled}).length>=2}function f(){if(U.forEach(function(t){t.root.removeClass("active")}),u()){var t=U[R];x.text(t.name.value+"'s Turn"),t.root.addClass("active")}else x.empty()}function b(){if(u()){do R++,R>=U.length&&(R=0);while(U[R].disabled);x.text(U[R].name.value+" is next")}else x.empty()}function m(){v(M.STOPPED),k(),D.text("Start"),S.removeAttr("style")}function v(t){S.removeClass(q),q=t,S.addClass(t);var n;switch(t){case M.PLAYING:n=T;break;case M.PAUSED:n=y;break;case M.STOPPED:n=C}p(n),N&&N.close()}function p(t){O.children().each(function(){$(this).removeClass("active")}),t.addClass("active")}function P(){B===o()&&S.css({"background-color":j.END,transition:"background-color "+B+"s"}),B--,D.text(h(B)),0===B&&d()}function g(){A&&clearInterval(A),A=setInterval(P,1e3)}function k(){clearInterval(A),A=null}function h(t){var n=Math.floor(t/60),e=t%60;return E(n)+":"+E(e)}function E(t){return(10>t?"0":"")+t}var S,D,x,A,N,I,T,y,C,w,O,G,L,Y,U,R,B=0,M={STOPPED:"stopped",PLAYING:"playing",PAUSED:"paused"},j={START:"#71B284",END:"#B22727"},q=M.STOPPED;return{init:t}}(),pages.timer.init();